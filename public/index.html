<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashControl Business</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { margin:0; font-family:'Poppins', sans-serif; background:#0d0d0d; color:white; text-align:center; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:24px; font-weight:700; box-shadow:0 4px 10px rgba(0,0,0,.4); }

    /* Splash */
    .splash {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:linear-gradient(135deg,#0d0d0d,#8e44ad,#b8860b);
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      font-size:2.5rem; font-weight:bold; z-index:9999; color:#fff;
      transition:opacity 1s ease-out;
    }
    .splash small { font-size:1rem; margin-top:10px; color:#ddd; }
    .splash.fade-out { opacity:0; pointer-events:none; }

    /* Home */
    .home { display:none; padding:30px; }
    h1 { color:#d4af37; margin-bottom:15px; }
    p { color:#ddd; }

    /* Login */
    #loginArea { margin:20px auto; padding:20px; background:#1a1a1a; border-radius:12px; width:320px; }
    #loginArea input { width:90%; padding:10px; margin:5px 0; border-radius:8px; border:none; }
    #loginArea button { padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer; background:#8e44ad; color:white; }
    #loginArea button:hover { background:#b8860b; }

    /* Cards */
    .cards {
      display:flex; justify-content:center; gap:25px; flex-wrap:wrap; margin-top:40px;
    }
    .card {
      background:#1a1a1a; border-radius:12px; padding:30px; width:220px; height:160px;
      cursor:pointer; box-shadow:0 4px 20px rgba(0,0,0,.6);
      transition:.3s; display:flex; flex-direction:column; align-items:center; justify-content:center;
    }
    .card:hover { transform:scale(1.05); background:#2c2c2c; }
    .card .icon { font-size:2.5rem; }
    .card h3 { margin-top:10px; color:#d4af37; }

    /* √Årea de pagamento */
    #pagamento { margin:40px auto; padding:20px; background:#1a1a1a; border-radius:12px; width:320px; display:none; }
    #pagamento h2 { color:#d4af37; margin-bottom:10px; }
  </style>
</head>
<body>

  <!-- Splash -->
  <div id="splash" class="splash">
    üöÄ DashControl
    <small>Carregando seu painel de controle...</small>
  </div>

  <!-- Home -->
  <div id="home" class="home">
    <header>üìä DashControl Business</header>
    <h1>Bem-vindo!</h1>
    <p>Fa√ßa login e ative seu acesso:</p>

    <!-- √Årea de Login -->
    <div id="loginArea">
      <h2>Login</h2>
      <input type="email" id="email" placeholder="E-mail"><br>
      <input type="password" id="senha" placeholder="Senha"><br>
      <button onclick="registrar()">Registrar</button>
      <button onclick="login()">Entrar</button>
      <button onclick="logout()">Sair</button>
    </div>

    <!-- Pagamento -->
    <div id="pagamento">
      <h2>Ative seu acesso</h2>
      <p>Assine o DashControl Business por apenas R$29,90/m√™s</p>
      <div class="checkout-btn"></div>
    </div>

    <!-- Cards (s√≥ aparecem ap√≥s pagamento confirmado) -->
    <div id="cards" class="cards" style="display:none;">
      <div class="card" onclick="location.href='dados.html'">
        <div class="icon">‚öôÔ∏è</div>
        <h3>Gerenciar Dados</h3>
      </div>
      <div class="card" onclick="location.href='dashboard.html'">
        <div class="icon">üìà</div>
        <h3>Visualizar Dashboard</h3>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { registrarUsuario, loginUsuario, sair } from "./firebase.js";

    window.registrar = () => {
      const email = document.getElementById("email").value;
      const senha = document.getElementById("senha").value;
      registrarUsuario(email, senha);
    };

    window.login = () => {
      const email = document.getElementById("email").value;
      const senha = document.getElementById("senha").value;
      loginUsuario(email, senha);
    };

    window.logout = () => sair();
  </script>

  <!-- Mercado Pago SDK -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script>
    // Splash
    const splash=document.getElementById('splash');
    const home=document.getElementById('home');
    setTimeout(()=> splash.classList.add('fade-out'),2000);
    splash.addEventListener('transitionend',()=> {
      splash.style.display='none';
      home.style.display='block';
    }, {once:true});

    // Inicializa Mercado Pago (somente PUBLIC KEY aqui)
    const mp = new MercadoPago("APP_USR-b41ecc24-87a5-43df-9dd3-6aa56cc5647b", { locale: "pt-BR" });

    // Busca prefer√™ncia no backend
    async function iniciarCheckout() {
      try {
        const email = document.getElementById("email").value || "teste@dashcontrol.com";

        const resp = await fetch("https://us-central1-dashcontrol-vendas.cloudfunctions.net/api/create_preference", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });

        const data = await resp.json();

        if (data.id) {
          mp.checkout({
            preference: { id: data.id },
            render: {
              container: ".checkout-btn",
              label: "Assinar Agora"
            }
          });
        } else {
          console.error("Erro: n√£o retornou id da prefer√™ncia", data);
        }

      } catch (err) {
        console.error("Erro ao iniciar checkout:", err);
      }
    }

    // Chama ao carregar a p√°gina
    iniciarCheckout();

    // Libera√ß√£o ap√≥s webhook
    function liberarAcesso() {
      document.getElementById("pagamento").style.display = "none";
      document.getElementById("cards").style.display = "flex";
    }
  </script>
</body>
</html>
