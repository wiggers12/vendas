<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DashControl Business - Dashboard</title>

  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

  <!-- Fonte -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { margin:0; font-family:'Poppins', sans-serif; background:#0d0d0d; color:white; }
    header { background:linear-gradient(90deg,#8e44ad,#b8860b); padding:15px; font-size:22px; font-weight:700; text-align:center; }
    h2 { color:#d4af37; margin:20px 0; text-align:center; }
    .chart-card {
      background:#1a1a1a;
      border-radius:12px;
      padding:15px;
      margin:20px auto;
      box-shadow:0 4px 20px rgba(0,0,0,0.6);
      max-width:1200px;
    }
    .chart { width:100%; height:400px; }
    select { margin:15px auto; display:block; padding:10px; border-radius:6px; border:none; background:#2c2c2c; color:white; }
  </style>
</head>
<body>

<header>ğŸ“Š DashControl Business - Dashboard</header>

<!-- SeleÃ§Ã£o do negÃ³cio -->
<h2>Escolha o negÃ³cio</h2>
<select id="tipoNegocio" onchange="atualizarDashboard()">
  <option value="">-- Selecione --</option>
  <option value="delivery">ğŸšš Delivery</option>
  <option value="salao">ğŸ’‡â€â™€ï¸ SalÃ£o</option>
  <option value="ecommerce">ğŸ›’ E-commerce</option>
  <option value="academia">ğŸ¥‹ Academia</option>
</select>

<!-- Ãrea de grÃ¡ficos -->
<div id="graficos" style="display:none;">
  <div class="chart-card"><div id="chartVendas" class="chart"></div></div>
  <div class="chart-card"><div id="chartEstoque" class="chart"></div></div>
  <div class="chart-card"><div id="chartFinanceiro" class="chart"></div></div>
  <div class="chart-card"><div id="chartPagamentos" class="chart"></div></div>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("dashBusiness")) || {delivery:[], salao:[], ecommerce:[], academia:[]};

function atualizarDashboard(){
  let negocio=document.getElementById("tipoNegocio").value;
  if(!negocio){ document.getElementById("graficos").style.display="none"; return; }
  let registros=dados[negocio];
  if(!registros || registros.length===0){ alert("Nenhum dado encontrado para este negÃ³cio."); return; }
  document.getElementById("graficos").style.display="block";

  // Clientes (Vendas)
  let clientes=registros.filter(r=>r.tipo==="cliente");
  let nomes=clientes.map(c=>c.nome);
  let valores=clientes.map(c=>c.valor);
  let servicos=clientes.map(c=>c.servico);

  let chartVendas=echarts.init(document.getElementById('chartVendas'));
  chartVendas.setOption({
    title:{text:"ğŸ“Š Vendas / ServiÃ§os", textStyle:{color:'#d4af37'}},
    tooltip:{trigger:'item'},
    xAxis:{type:'category', data:servicos, axisLabel:{color:'#fff'}},
    yAxis:{type:'value', axisLabel:{color:'#fff'}},
    series:[{data:valores, type:'bar', itemStyle:{color:'#8e44ad', shadowBlur:10, shadowColor:'#000'}, label:{show:true, color:'#fff'}}]
  });

  // Estoque
  let estoque=registros.filter(r=>r.tipo==="estoque");
  let estProdutos=estoque.map(e=>e.produto);
  let estQtd=estoque.map(e=>e.quantidade);
  let chartEstoque=echarts.init(document.getElementById('chartEstoque'));
  chartEstoque.setOption({
    title:{text:"ğŸ“¦ Estoque Atual", textStyle:{color:'#d4af37'}},
    xAxis:{type:'category', data:estProdutos, axisLabel:{color:'#fff'}},
    yAxis:{type:'value', axisLabel:{color:'#fff'}},
    series:[{data:estQtd, type:'bar', itemStyle:{color:'#1abc9c'}, label:{show:true, color:'#fff'}}]
  });

  // Financeiro (Entradas x SaÃ­das)
  let entradas=clientes.reduce((s,c)=>s+parseFloat(c.valor||0),0);
  let saidas=0; // por enquanto sÃ³ entradas
  let chartFinanceiro=echarts.init(document.getElementById('chartFinanceiro'));
  chartFinanceiro.setOption({
    title:{text:"ğŸ’° Entradas x SaÃ­das", textStyle:{color:'#d4af37'}},
    tooltip:{trigger:'item'},
    legend:{textStyle:{color:'#fff'}},
    series:[{type:'pie', radius:['40%','70%'],
      data:[{name:"Entradas",value:entradas},{name:"SaÃ­das",value:saidas}],
      itemStyle:{shadowBlur:15, shadowColor:'#000'},
      label:{color:'#fff'}
    }]
  });

  // Formas de Pagamento
  let formas={};
  clientes.forEach(c=>{ formas[c.pagamento]=(formas[c.pagamento]||0)+c.valor; });
  let chartPagamentos=echarts.init(document.getElementById('chartPagamentos'));
  chartPagamentos.setOption({
    title:{text:"ğŸ’³ Formas de Pagamento", textStyle:{color:'#d4af37'}},
    tooltip:{trigger:'item'},
    legend:{textStyle:{color:'#fff'}},
    series:[{type:'pie', radius:['40%','70%'],
      data:Object.keys(formas).map(f=>({name:f,value:formas[f]})),
      itemStyle:{shadowBlur:15, shadowColor:'#000'},
      label:{color:'#fff'}
    }]
  });
}
</script>

</body>
</html>